(setq buffer-file-coding-system 'utf-8-unix)

(load-file "~/.emacs.d/chestnut_syntax.el")
(load-file "~/.emacs.d/modern-tab-bar.el")
(load-file "~/.emacs.d/code_run.el")
(load-file "~/.emacs.d/simpc-mode.el")

(setq make-backup-files nil)

(global-display-line-numbers-mode 1)
(tool-bar-mode -1)
(menu-bar-mode -1)

(defun move-line-up ()
  "Move up the current line."
  (interactive)
  (transpose-lines 1)
  (forward-line -2)
  (indent-according-to-mode))

(defun move-line-down ()
  "Move down the current line."
  (interactive)
  (forward-line 1)
  (transpose-lines 1)
  (forward-line -1)
  (indent-according-to-mode))

(global-set-key (kbd "M-p") 'move-line-up)
(global-set-key (kbd "M-n") 'move-line-down)

(global-set-key (kbd "M-g") 'goto-line)

(use-package lsp-mode
  :ensure t
  :hook ((c-mode c++-mode) . lsp)
  :config
  (setq lsp-clients-clangd-args
        '("--compile-commands-dir=./"
          "--completion-style=detailed"))
  )

(defun regenerate-compile-commands ()
  (when (string-equal (buffer-name) "Makefile")
    (shell-command "compiledb -n make")))

(add-hook 'after-save-hook 'regenerate-compile-commands)
